-- explanation:
-- computes a 3-month rolling average of monthly revenue
-- helps compare performance across seasons

with monthly_revenue as (
    select
        date_format(transaction_date, "%y-%m) as month,       -- gets montly total revenue
        sum(amount) as monthly_revenue
    from transactions
    group by month
)

select
    month,           -- gets 3 month avg rolling revenue
    avg(monthly_revenue) over (order by month rows between 2 preceding and current row) as rolling_3_month_avg_revenue
from monthly_revenue
order by month;
